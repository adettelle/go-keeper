# Менеджер паролей go-keeper

## Общие требования

go-keeper представляет собой клиент-серверную систему, позволяющую пользователю надёжно и безопасно хранить логины, пароли, бинарные данные и прочую приватную информацию.

## Типы хранимой информации

* пары логин/пароль
* произвольные текстовые данные
* произвольные бинарные данные
* данные банковских карт

## Серверная часть

**Сервер реализует следующую бизнес-логику**

* регистрация, аутентификация и авторизация пользователей
* хранение приватных данных
* синхронизация данных между несколькими авторизованными клиентами одного владельца 
* передача приватных данных владельцу по запросу

## Клиентская часть

**Клиент реализует следующую бизнес-логику**

* аутентификация и авторизация пользователей на удалённом сервере
* доступ к приватным данным по запросу

## Реализация

### Использованные технологии

* [minio] - (https://min.io/) объектная система хранения данных
* [postgresql] - (https://www.postgresql.org/) хранение данных
* [jwt] - (https://pkg.go.dev/github.com/golang-jwt/jwt/v4) аутентификация пользователей во время работы с сервером
* [https] - протокол взаимодействия клиент-сервер
* [kong] - (https://github.com/alecthomas/kong) парсер командной строки
* [keyring] - (https://github.com/99designs/keyring) keyring предоставляет общий интерфейс для целого ряда сервисов безопасного хранения учетных данных

### Детали реализации

Для хранения технической информации и данных пользователей использована база PostgreSQL. В качестве хранилища бинарных данных используется сервис minio.

Регистрация новых пользователей и первичная аутентификация происходит через пару логин/пароль.
После аутентификации пользователю отправляется jwt токен с ограниченным временем жизни. 
Дальнейшие действия в системе производятся с использованием этого токена, без необходимости передачи пары логин-пароль. В качестве защищённого хранилища для токена на машине клиента используется имеющийся в системе вариант из списка поддерживаемых библиотекой [keyring] - (https://github.com/99designs/keyring):

* macOS Keychain
* Windows Credential Manager
* Secret Service (Gnome Keyring, KWallet)
* KWallet
* Pass
* KeyCtl

В случае, если в системе недоступно ни одно из указанных хранилищ, токен сохраняется в файле в домашней директории пользователя, зашифрованном произвольным паролем. В этом случае приложение запрашивает этот пароль при любом взаимодействии с участием Jwt токена. 

При повторном логине пользователя в системе с использованием пары логин-пароль, все существующие ранее сессионные токены помечаются в БД сервером как невалидные. Таким образом одновременное использование пользовательского аккаунта с разных компьютеров сознательно запрещено.  

Для обеспечения безопасности на транспортном уровне для враимодействия клиент-сервер используется протокол TLS. Сертификат и приватный ключ клиента загружаются из директории ./keys (путь указан относительно местонаходдения клиентского приложения). В случае отсутствия, они автоматически генерирутюся клиентом и помещаются в директорию ./keys 

Секретные данные пользователя, такие как данные кредитных карт или пароли от сервисов, хранятся в БД в зашифрованном виде (используется протокол AES).

Клиентское приложение выводит запрошенные секретные данные пользователя (пароли, данные карт) в stdout. Рекомендуется перенаправления потока вывода в файл, без показа в терминале во избежание потенциального извлечения злоумышленниками из bash history, например 
```BASH
go-keeper get-password -t my_vk_pass1 > saved.txt
```

### Локальный запуск сервера и всей инфраструктуры

**Требования:**

Для локального запуска необходимо следующее ПО:
* docker
* docker-compose
* make
* golang (*опционально, для запуска из исходников. Версии не менее 1.23*)

```BASH
make run-all
```

### Запуск клиента

Запустить клиент можно следующим образом:

1. Вариант запуска из исходных кодов репозитория

```BASH
DEBUG_RUN_INSECURE=true go run ./cmd/client/ --help
```
Переменная DEBUG_RUN_INSECURE отключает верификацию серверного TLS сертификата и позволяет работать с локально запущенным сервером с self-signed сертификатом по https на localhost. На прочие средства обеспечения безопасности (шифрование данных, keystore, jwt) эта переменная не влияет.

2. Вариант использования сборки под свою ос и архитектуру

Скачать сборку клиента для свей ОС и архитектуры из https://github.com/adettelle/go-keeper/releases
и запустить. В данный момент доступны релизы клиента для os gnu/linux, macOS и Windows, под архитектуры amd64 и arm46.

Например в случае arm macos

```BASH
DEBUG_RUN_INSECURE=true go-keeper-client-darwin-arm64 --help
```
